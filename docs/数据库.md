# 创建用户表

```sql
CREATE TABLE users (
  -- 基本标识字段
  id INT AUTO_INCREMENT PRIMARY KEY,
  uid BIGINT UNIQUE NOT NULL, -- 唯一用户标识符，使用类似小红书号的纯数字格式
  email VARCHAR(255) UNIQUE NOT NULL,
  password VARCHAR(255) NOT NULL,
  
  -- 个人资料字段
  username VARCHAR(50) UNIQUE, -- 用户名（可用于登录）
  nickname VARCHAR(50) NOT NULL DEFAULT '', -- 昵称
  avatar VARCHAR(255) NOT NULL DEFAULT '', -- 头像URL
  
  -- 联系信息
  phone VARCHAR(20) UNIQUE, -- 手机号码
  location VARCHAR(100) NOT NULL DEFAULT '', -- 位置信息
  website VARCHAR(255) NOT NULL DEFAULT '', -- 个人网站
  
  -- 账户状态
  status ENUM('active', 'inactive', 'banned', 'deleted') NOT NULL DEFAULT 'active', -- 账户状态
  email_verified BOOLEAN NOT NULL DEFAULT false, -- 邮箱是否验证
  phone_verified BOOLEAN NOT NULL DEFAULT false, -- 手机是否验证
  
  -- 社交统计信息
  followers_count INT NOT NULL DEFAULT 0, -- 粉丝数
  following_count INT NOT NULL DEFAULT 0, -- 关注数
  posts_count INT NOT NULL DEFAULT 0, -- 发布内容数
  likes_count INT NOT NULL DEFAULT 0, -- 获赞数
  
  -- 隐私设置
  is_private BOOLEAN NOT NULL DEFAULT false, -- 是否私密账户
  allow_message BOOLEAN NOT NULL DEFAULT true, -- 是否允许私信
  allow_comment BOOLEAN NOT NULL DEFAULT true, -- 是否允许评论
  
  -- 时间戳
  last_login_at TIMESTAMP NULL, -- 最后登录时间
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP, -- 创建时间
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP -- 无末尾逗号
  
  -- 索引优化
  , INDEX idx_uid (uid)
  , INDEX idx_username (username)
  , INDEX idx_email (email)
  , INDEX idx_status (status)
);

-- 创建触发器，在插入新用户时生成类似小红书号的随机数字ID
DELIMITER //
CREATE TRIGGER before_user_insert
BEFORE INSERT ON users
FOR EACH ROW
BEGIN
    DECLARE new_uid BIGINT;
    DECLARE is_unique INT DEFAULT 0;
    
    -- 生成8位随机数字ID（可根据需要调整位数）
    WHILE is_unique = 0 DO
        SET new_uid = FLOOR(10000000 + RAND() * 90000000); -- 8位随机数，范围10000000-99999999
        SELECT COUNT(*) INTO is_unique FROM users WHERE uid = new_uid;
        IF is_unique = 0 THEN
            SET NEW.uid = new_uid;
            SET is_unique = 1;
        END IF;
    END WHILE;
END //
DELIMITER ;
```